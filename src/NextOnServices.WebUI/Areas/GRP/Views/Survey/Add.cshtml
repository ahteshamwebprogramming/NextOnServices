@model GRP.Infrastructure.Models.Survey.SurveyDTO
@{
    ViewData["Title"] = "Add";
    Layout = "~/Areas/GRP/Views/Shared/_Layout.cshtml";
}

<style>
    .select2-container--default .select2-selection--single {
        padding: 0.5rem 0.81rem;
    }

    .select2-container .select2-selection--single {
        height: 2.575rem;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 38px;
    }
</style>
<div class="row">
    <div class="col-12 grid-margin stretch-card">
        <div class="card">
            <div class="row">
                <div class="col-md-12">
                    <div class="card-body">
                        <div class="row">
                            <div class="offset-1 col-md-10 grid-margin stretch-card">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="card-title">Add Survey</h4>
                                        <p class="card-description">
                                            Please fill the in the details below
                                        </p>
                                        <form class="forms-sample" id="form">
                                            <div style="border: 2px dashed #4B49AC;  padding: 15px;">
                                                <div class="row">
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Survey Name</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="SurveyName">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Survey Description</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="SurveyDescription">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Image URL</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="ImageUrl">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Survey URL</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="SurveyUrl">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Duration</label>
                                                        <input type="number" class="form-control form-control-sm" asp-for="Duration">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="">Client Detail</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="ClientDetail">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Max Count</label>
                                                        <input type="number" class="form-control form-control-sm" asp-for="MaxCount">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Is Active</label>
                                                        <br />
                                                        <input type="checkbox" class="" asp-for="IsActive">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Survey Point</label>
                                                        <input type="number" class="form-control form-control-sm" asp-for="SurveyPoint">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Click Count</label>
                                                        <input type="number" class="form-control form-control-sm" asp-for="ClickCount">
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="Pname">Survey Code</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="SurveyIdHost">
                                                    </div>


                                                </div>
                                            </div>
                                            <div style="border: 2px dashed #4B49AC;  padding: 15px;margin-top:5px;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h5 style="text-decoration: underline;">Critearea for showing Survey</h5>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="ClientId">Gender</label>
                                                        <select class="form-control form-control-sm" asp-for="Gender">
                                                            <option value="3">All</option>
                                                            <option value="1">Male</option>
                                                            <option value="2">Female</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="ClientId">Country</label>
                                                        <select class="form-control form-control-sm" asp-for="Country">
                                                            <option value="3">Select</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="ClientId">Age From</label>
                                                        <select class="form-control form-control-sm" asp-for="AgeFrom">
                                                            <option value="3">Select</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="ClientId">Age To</label>
                                                        <select class="form-control form-control-sm" asp-for="AgeTo">
                                                            <option value="3">Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="border: 2px dashed #4B49AC;  padding: 15px;margin-top:5px;margin-bottom:5px;">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h5 style="text-decoration: underline;">URLs</h5>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label for="Pname">Complete URL</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="CompleteURL">
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label for="Pname">Terminate URL</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="TerminateURL">
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label for="Pname">Quotafull URL</label>
                                                        <input type="text" class="form-control form-control-sm" asp-for="QuotafullURL">
                                                    </div>
                                                </div>
                                            </div>

                                            <input type="hidden" asp-for="SurveyId" />
                                            <input type="hidden" />
                                            <button type="button" class="btn btn-success mr-2 btn-sm" onclick="SaveSurvey()">Submit</button>
                                            <button type="button" onclick="javascript:window.location.href='/GRP/Survey/Add'" class="btn btn-danger btn-sm">Cancel</button>
                                            <a class="btn btn-light btn-sm" href="/GRP/Survey/List" name="ViewAllSurveys">Go To List</a>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.4/bootstrap-editable/js/bootstrap-editable.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("select").select2();
            ListPartialView();
        });

        function ListPartialView() {
            //BlockUI();
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/GRP/ProfileInfoCategory/ListPartialView',
                //data: JSON.stringify({ ProjectId: project, ReportType: reportType }),
                cache: false,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {
                    $("#PartialViews").html(data);
                    //UnblockUI();
                },
                error: function (result) {
                    $erroralert("Error!", error.responseText);
                    UnblockUI();

                }
            });
        }
        function AddPartialView() {
            //BlockUI();
            var inputDTO = {};
            inputDTO.Id = 0;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/GRP/ProfileInfoCategory/AddPartialView',
                data: JSON.stringify(inputDTO),
                cache: false,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {
                    $("#PartialViews").html(data);
                    $('select').select2();
                    //UnblockUI();
                },
                error: function (result) {
                    $erroralert("Error!", error.responseText);
                    UnblockUI();
                }
            });
        }

        function Add() {
            let data = $("#form");
            var inputDTO = {};
            inputDTO.ProfileInfoCategoryId = $(data).find("[name='ProfileInfoCategoryId']").val();
            inputDTO["CategoryName"] = $(data).find("[name='CategoryName']").val();
            BlockUI();
            $.ajax({
                type: "POST",
                url: "/GRP/ProfileInfoCategory/Add",
                contentType: 'application/json',
                data: JSON.stringify(inputDTO),
                success: function (data) {
                    $successalert("Success", "Category is added succesfully");
                    ListPartialView();
                    UnblockUI();
                },
                error: function (error) {
                    $erroralert("Error!", error.responseText);
                    UnblockUI();
                }
            });
        }

        function edit(ProfileInfoCategoryId) {
            BlockUI();
            var inputDTO = {};
            inputDTO.ProfileInfoCategoryId = ProfileInfoCategoryId;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/GRP/ProfileInfoCategory/AddPartialView',
                data: JSON.stringify(inputDTO),
                cache: false,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {
                    $("#PartialViews").html(data);
                    UnblockUI();
                },
                error: function (result) {
                    $erroralert("Error!", error.responseText);
                    UnblockUI();
                }
            });
        }
        function addSurvey(ProfileInfoCategoryId, encProfileInfoCategoryId) {
            BlockUI();
            var inputDTO = {};
            inputDTO.ProfileInfoCategoryId = ProfileInfoCategoryId;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/GRP/ProfileInfoCategory/AddSurveyPartialView',
                data: JSON.stringify(inputDTO),
                cache: false,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {
                    $("#PartialViews").html(data);
                    $("select").select2();
                    $("[name='ProfileInfoCategoryId']").val(ProfileInfoCategoryId);
                    $("[name='encProfileInfoCategoryId']").val(encProfileInfoCategoryId);
                    $("[name='ViewAllSurveys']").attr("href", $("[name='ViewAllSurveys']").attr("href").replace("encProfileInfoCategoryId", encProfileInfoCategoryId));


                    intiEdit();
                    UnblockUI();
                },
                error: function (error) {
                    $erroralert("Error!", error.responseText);
                    UnblockUI();
                }
            });
        }



        function Delete(ProfileInfoCategoryId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                customClass: {
                    confirmButton: 'btn btn-primary me-3',
                    cancelButton: 'btn btn-label-secondary'
                },
                buttonsStyling: false
            }).then(function (result) {
                if (result.value) {
                    BlockUI();
                    var inputDTO = {};
                    inputDTO.ProfileInfoCategoryId = ProfileInfoCategoryId;
                    $.ajax({
                        type: "POST",
                        url: "/GRP/ProfileInfoCategory/Delete",
                        contentType: 'application/json',
                        data: JSON.stringify(inputDTO),
                        success: function (data) {
                            $successalert('Success', "Deleted successfully");
                            ListPartialView();
                            UnblockUI();
                        },
                        error: function (error) {
                            $erroralert("Error!", error.responseText);
                            UnblockUI();
                        }
                    });
                }
            });

        }
        function addRow(currObj) {
            //let tr = $(currObj).closest("table").find("tbody").find("tr");
            //let indx = tr.length + 1;
            $(currObj).closest("table").find("tbody").append("<tr><td name='value'><a href='javascript:void(0)' class='edit_text'></a></td><td name='label'><a href='javascript:void(0)' class='edit_text'></a></td><td><a href='javascript:void(0)' style='color:red;' onclick='deleteRow(this)'>Delete</a></td></tr>");

            $.fn.editable.defaults.mode = 'inline';
            $('.edit_text').editable({
                type: 'text',
                success: function (k, v) {
                    console.log(v);
                }
            });
        }

        function deleteRow(currObj) {
            $(currObj).closest("tr").remove();
        }

        function intiEdit() {
            $.fn.editable.defaults.mode = 'inline';
            $('.edit_text').editable({
                type: 'textarea',
                success: function (k, v) {
                    console.log(v);
                    // var href = $(this).attr("href");
                    // $('.name-list '+href).html(v);
                }
            });
        }

        function SaveSurvey() {
            var inputDTO = getFormData();
            BlockUI();
            $.ajax({
                type: "POST",
                url: "/GRP/Survey/SaveSurvey",
                contentType: 'application/json',
                data: JSON.stringify(inputDTO),
                success: function (data) {
                    UnblockUI();
                    //$(currDiv).parent().parent().parent().remove();
                    $successalert("Success!", "Saved succesfully.");
                    window.location.href = "/GRP/Survey/List";
                },
                error: function (error) {
                    $erroralert("Error!", error.responseText + '!'); UnblockUI();
                    UnblockUI();
                }
            });
        }
        function getFormData() {
            var inputDTO = {};
            inputDTO.SurveyId = $.trim($("#form").find("[name='SurveyId']").val()) == "" ? 0 : $("#form").find("[name='SurveyId']").val();
            inputDTO.SurveyName = $("#form").find("[name='SurveyName']").val();
            inputDTO.SurveyDescription = $("#form").find("[name='SurveyDescription']").val();
            inputDTO.ImageUrl = $("#form").find("[name='ImageUrl']").val();
            inputDTO.SurveyUrl = $("#form").find("[name='SurveyUrl']").val();
            inputDTO.Duration = $.trim($("#form").find("[name='Duration']").val()) == "" ? 0 : $("#form").find("[name='Duration']").val();//int
            inputDTO.ClientDetail = $("#form").find("[name='ClientDetail']").val();
            inputDTO.MaxCount = $.trim($("#form").find("[name='MaxCount']").val()) == "" ? 0 : $("#form").find("[name='MaxCount']").val();//MaxCount
            inputDTO.IsActive = Boolean($("#form").find("[name='IsActive']").val() === 'true');
            inputDTO.Gender = $("#form").find("[name='Gender']").val();
            inputDTO.SurveyPoint = $.trim($("#form").find("[name='SurveyPoint']").val()) == "" ? 0 : $("#form").find("[name='SurveyPoint']").val();//SurveyPoint
            inputDTO.ClickCount = $.trim($("#form").find("[name='ClickCount']").val()) == "" ? 0 : $("#form").find("[name='ClickCount']").val();//ClickCount
            //inputDTO.Criteria = $("#form").find("[name='Criteria']").val();
            inputDTO.SurveyIdHost = $("#form").find("[name='SurveyIdHost']").val();
            inputDTO.CompleteURL = $("#form").find("[name='CompleteURL']").val();
            inputDTO.QuotafullURL = $("#form").find("[name='QuotafullURL']").val();
            inputDTO.TerminateURL = $("#form").find("[name='TerminateURL']").val();
            inputDTO.Country = $("#form").find("[name='Country']").val();
            inputDTO.AgeFrom = $("#form").find("[name='AgeFrom']").val();
            inputDTO.AgeTo = $("#form").find("[name='AgeTo']").val();
            return inputDTO;
        }


    </script>
}



